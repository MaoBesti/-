2.1 处理器与寄存器
    ·理解处理器及其部件
    ·理解用户程序可见寄存器
    ·理解控制与状态寄存器
    ·掌握程序状态字的概念

用户程序可见寄存器：
可以使程序员减少访问主存储器的次数，提高指令
执行的效率；
所有程序可使用，包括应用程序和系统程序

·数据寄存器：又称通用寄存器
·地址寄存器：索引、栈指针、段地址等
索引：SI DI
栈指针：SP BP
段地址：CS DS SS  ES

·控制与状态寄存器
·用于控制处理器的操作；主要被具有特权的操作系统程序
使用，以控制程序的执行
程序计数器PC：存储将取指令的地址
指令寄存器IR：存储最近使用的指令
条件码CC：CPU为指令操作结果设置的位，标志正/负/零/溢出等结果
标志位：中断位、中断允许位、中断屏蔽位、处理器模式位、内存保护位......等



程序状态字PSW：
PSW既是操作系统的概念，值记录当前程序运行的动态信息，通常包含：
·程序计数器，指令寄存器，条件码
·中断字，中断允许/禁止，中断屏蔽，处理器模式，内存保护，调试控制
PSW也是计算机系统的寄存器
·通常设置一组控制与状态寄存器
·也可以专设一个PSW寄存器


2.2 指令与处理器模式
·理解机器指令及其执行过程
·理解指令流水线
·掌握特权指令与非特权指令
·掌握处理器模式及其切换

机器指令
·机器指令是计算机系统执行的基本命令，是中央处理器执行的基本单位
·指令是由一个或多个字节组成，包括操作码字段、一个或多个操作数地址字段、以及一些
表征机器状态的状态字以及特征码
·指令完成各种算术逻辑运算、数据传输、控制流跳转码

指令执行周期与指令流水线
·指令执行周期
    取指  解码  执行

特权指令与非特权指令
·用户程序并非能够使用全部机器指令，那些与计算机核心资源相关的特殊指令会被保护
·如：I/O指令、置PC指令、等等
·核心资源相关的指令只能被操作系统程序使用


特权指令：只能被操作系统内核使用的指令
非特权指令：能够被所有程序使用的指令

·处理器模式
     ·计算机通过设置处理器模式实现特权指令管理
     ·计算机一般是指0、1、2、3等四种运行模式，建议分别对应：0 操作系统内核、
     1 系统调用、 2 共享库程序、3用户程序等保护级别
     ·一般来说，现代操作系统只是用0 和 3 两种模式

模式的切换
    ·简称模式切换，包括 用户模式-> 内核模式  和内核模式->用户模式   的两种类型转换
    ·中断、异常或系统异常 等事件导致用户程序向OS内核切换，触发 用户模式-> 内核模式
         程序运行时发生并响应中断
         程序运行时发生异常
         程序请求操作系统服务
    ·OS内核处理完成后，调用中断返回指令，触发：内核模式-> 用户模式




2.3中断
·掌握中断的基本概念
·理解中断、异常与系统异常

·中断的概念
     ·中断是指程序执行过程中，遇到急需处理的事件时，暂时中止CPU上现行程序的运行，转去
     执行相应的事件处理程序，待处理完成后再返回源程序被终端处或调度其他程序执行的过程
     ·操作系统是“中断驱动”的;换言之，中断是激活操作系统的唯一方式
     ·中断有广义和狭义之分，上述中断是指广义的中断
     ·狭义的中断来源于处理器之外的中断事件，即与当前运行指令无关的中断事件
     ·异常是指运行指令引起的中断事件，如地址异常、算术异常、处理器硬件故障等
     ·系统异常：指执行陷入指令而触发系统调用引起的中断事件，如请求设备、请求I/O 、
     创建进程等



2.4 中断源

·掌握中断源
·掌握中断源的处理原则

中断源——处理器硬件故障中断事件
·由处理器、内存储器、总线等硬件故障引起
·处理原则：保护现场，停止设备，停止CPU，向操作员报告，等待人工干预


中断源——程序性中断事件
·处理器执行机器指令引起
    ·除数为零、操作数溢出等算术异常
    处理原则：简单处理，报告用户；也可可以由用户编写中断续元程序处理

    非法指令、用户态使用特权指令、地址越界、非法存取等指令异常
    处理原则：终止进程

    终止进程指令
    处理原则：终止进程

    虚拟地址异常
    处理原则：调整内存后重新执行指令

中断源——自愿性中断事件
 ·处理器执行陷入指令请求OS服务引起；
  在操作系统中，它一般又被称作系统调用
 ·请求分配外设、请求I/O、等等
 ·处理流程：陷入OS，保护现场，根据功能号查入口地址，跳转具体处理程序

中断源——I/O中断事件
·来源于外围设备报告I/O状态的中断事件
I/O 完成：调整进程状态，释放等待进程
I/O 出错：等待人工干预
I/O 异常：等待人工干预


中断源——外部中断事件
·由外围设备发出的信号引起的中断事件
    时钟中断、间隔时钟中断：记时与时间片处理；
    设备报到与结束中断：调整设备表；
    键盘/鼠标信号中断：根据信号作出相应反应；
    关机/重启动中断:写回文件，停止设备与CPU

2.5 中断系统1

·了解中断系统
·了解中断管理与指令执行周期
·掌握中断响应7与中断装置

中断系统
   ·中断系统是计算机系统中响应和处理中断的系统，包括硬件子系统和软件子系统两部分
   ·中断响应由硬件子系统完成
   ·中断处理由软件子系统完成

中断响应处理与指令执行周期
    ·在指令执行周期最后增加一个微操作，以响应中断

中断装置
   ·计算机系统中发现并响应中断/异常的硬件装置成为中断装置
   ·由于中断源的多样性，硬件实现的中断装置有多种，分别处理不同类型的中断
   ·这些中断装置因计算机而异，通常有：
        处理器外的中断：由中断控制器发现和响应
        处理器内的异常：由指令的控制逻辑和实现线路发现和响应，相应机制成为陷阱
        请求OS服务的系统异常：处理器执行陷入指令时直接触发，相应机制称为系统陷阱

   中断控制器：CPU的一个控制部件，包括中断控制逻辑线路和中断寄存器
   ·外部设备向其发出中断请求IRQ，在中断寄存器中设置已发生的中断
   ·指令处理结束前，会检查中断寄存器，若有不被屏蔽的中断产生，则改变处理器内操作的顺序，
   引出操作系统中的中断处理程序

   陷阱与系统陷阱
   ·陷阱与系统陷阱：指令的逻辑实现线路的一部分
   ·执行指令出现异常后，会根据异常情况转向操作系统的异常处理程序
   ·出现虚拟地址异常后，需要重新执行指令，往往越过陷阱独立设置页面异常处理程序
   ·执行陷入指令后，越过陷阱处理，出发系统陷阱，激活系统调用处理程序


中断响应过程
    ·发现中断源，提出中断请求
        ·发现中断寄存器中记录的中断
        ·决定这些中断是否被屏蔽
        ·当有多个要响应的中断源时，根据规定的优先级选择一个
    ·中指当前程序的执行
        ·保存当前程序的PSW/PC到核心栈
    ·转向操作系统的中断处理程序

    
